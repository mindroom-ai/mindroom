# Task: Improve MindRoom CLI Onboarding & Error Messages

## Goal
Improve the onboarding experience for users running MindRoom as a local CLI tool (`uvx mindroom` or `mindroom`). Currently, running without proper setup produces overwhelming Pydantic validation noise instead of helpful guidance.

## Problems to Fix

1. **No `config` subcommand group** — there's no `mindroom config init/edit/show` to help users create and manage config
2. **Overwhelming error output** — when config is missing or invalid, users see raw Pydantic `ValidationError` tracebacks instead of friendly messages
3. **No guided setup** — a new user running `uvx mindroom` for the first time gets no help with initial setup
4. **The existing `validate` command is top-level** — should be moved under `config` subcommand group

## What to Implement

### 1. Add `mindroom config` subcommand group

Create a new file `src/mindroom/cli_config.py` with these subcommands:

- **`mindroom config init`** — Generate a minimal starter `config.yaml` with commented examples
  - Should create a minimal but functional config (1 agent, 1 model, basic defaults)
  - Ask for confirmation before overwriting existing config
  - Print next steps after creation
  - Support `--path` to specify custom location
  - Support `--minimal` for bare minimum config vs a richer example

- **`mindroom config show`** — Display current config with syntax highlighting
  - Show where the config was found
  - Handle missing config gracefully (suggest `mindroom config init`)
  - Support `--raw` for plain output

- **`mindroom config edit`** — Open config in $EDITOR
  - Editor detection: `$EDITOR` → `$VISUAL` → `nano` → `vim` → `vi`
  - Handle missing config (suggest init first)

- **`mindroom config validate`** — Move the existing `validate` command here
  - Keep the existing validation logic but improve error formatting
  - Also validate environment variables (check if required API keys are set)

- **`mindroom config path`** — Show the resolved config file path and search locations

### 2. Improve Error Messages in `run` Command

In `src/mindroom/cli.py`, wrap the `_run()` function to catch common errors and display friendly messages:

- **Missing config.yaml**: Instead of FileNotFoundError, show:
  ```
  Error: No config.yaml found.

  MindRoom needs a configuration file to know which agents to run.

  Quick start:
    mindroom config init    Create a starter config
    mindroom config edit    Edit your config

  Config search locations:
    1. ./config.yaml (current directory)
    2. $MINDROOM_CONFIG_PATH (if set)

  Learn more: https://github.com/mindroom-ai/mindroom
  ```

- **Invalid config (Pydantic ValidationError)**: Instead of raw traceback, show:
  ```
  Error: Invalid configuration in config.yaml

  Issues found:
    • agents → code → model: Model 'nonexistent' is not defined in models section
    • models → default → provider: Invalid provider 'fake'

  Fix these issues:
    mindroom config edit      Edit your config
    mindroom config validate  Check config after editing
  ```

- **Missing environment variables** (e.g., no API keys): Show:
  ```
  Error: Missing required environment variables.

  Your config uses these providers that need API keys:
    • anthropic: Set ANTHROPIC_API_KEY
    • openai: Set OPENAI_API_KEY

  You can set these in a .env file or export them in your shell.
  ```

- **Matrix connection errors**: Show friendly message about Matrix homeserver setup

### 3. Improve the Default Help Output

When running `mindroom` with no args, show a more helpful message:

```
MindRoom - AI agents that live in Matrix

Commands:
  run        Start the multi-agent system
  config     Manage configuration (init, edit, show, validate)
  version    Show version information

Quick start:
  mindroom config init   Create a starter config
  mindroom run           Start the system

Use 'mindroom <command> --help' for more information.
```

### 4. Create a Minimal Config Template

Create `src/mindroom/config_template.yaml` to be bundled with the package. This is the template used by `config init`:

```yaml
# MindRoom Configuration
# Generated by: mindroom config init
# Docs: https://github.com/mindroom-ai/mindroom

# Define your AI models
models:
  default:
    provider: anthropic  # Options: anthropic, openai, google, openrouter, ollama
    id: claude-sonnet-4-5-latest

# Define your agents
agents:
  assistant:
    display_name: Assistant
    role: A helpful general-purpose assistant
    model: default
    rooms:
      - lobby
    tools: []
    instructions:
      - Be helpful and conversational

# Router configuration (routes messages to the right agent)
router:
  model: default

# Default settings for all agents
defaults:
  markdown: true
```

## Architecture Notes

- **Current CLI**: `src/mindroom/cli.py` uses Typer with 3 commands: `version`, `validate`, `run`
- **Config loading**: `Config.from_yaml()` in `src/mindroom/config.py` (line ~366)
- **Constants**: `src/mindroom/constants.py` has `DEFAULT_AGENTS_CONFIG` path resolution
- **Existing config_commands.py**: `src/mindroom/config_commands.py` is for the in-chat `!config` command (Matrix bot), NOT the CLI — leave it alone
- **Entry point**: `pyproject.toml` line 380: `scripts.mindroom = "mindroom.cli:main"`

## Reference: agent-cli's config_cmd.py Pattern

Look at `/home/basnijholt/Work/agent-cli/agent_cli/config_cmd.py` for inspiration on:
- How `config init/edit/show` subcommands are structured
- Error message formatting with Rich
- Editor detection logic
- Config path resolution

## Implementation Guidelines

1. Create `src/mindroom/cli_config.py` for the config subcommand group
2. Modify `src/mindroom/cli.py` to:
   - Import and register the config subcommand group
   - Remove the standalone `validate` command (moved to `config validate`)
   - Add error handling wrappers around `_run()`
3. Create `src/mindroom/config_template.yaml` for the init template
4. Add the template to package data in `pyproject.toml` if needed
5. Write tests in `tests/test_cli.py` (or extend existing tests)

## Testing

- Run `pytest tests/` to verify nothing breaks
- Run `pre-commit run --all-files` before considering done
- Test the actual CLI commands manually if possible:
  - `mindroom --help`
  - `mindroom config --help`
  - `mindroom config init --help`

## DO NOT

- Touch `src/mindroom/config_commands.py` — that's the in-chat bot config command
- Add new dependencies
- Over-engineer — keep it simple and functional
- Break existing `mindroom run` behavior
- Add imports inside functions (keep at top of file per project rules)

## When complete

Write a summary to `.claude/REPORT.md` including:
- What you implemented/changed
- Key decisions you made
- Any questions or concerns for review

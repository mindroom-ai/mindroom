# Tuwunel configuration for Mindroom PRODUCTION
# Secure configuration with registration disabled

[global]
# Server name - Override with TUWUNEL_SERVER_NAME env var
server_name = "localhost"

# Data directory - Override with TUWUNEL_DATABASE_PATH env var
database_path = "/var/lib/tuwunel"

# Network configuration
address = "0.0.0.0"  # Required for Docker
port = 6167  # Override with TUWUNEL_PORT env var

# Performance and capacity settings - PRODUCTION SETTINGS
cache_capacity_modifier = 1.0  # Standard cache sizes
db_cache_capacity_mb = 256.0  # Standard database read cache
db_write_buffer_capacity_mb = 128.0  # Standard database write cache
max_request_size = 52428800  # 50MB for media
max_fetch_prev_events = 1000  # Reasonable event fetching

# Connection timeouts - PRODUCTION SETTINGS
request_conn_timeout = 30
request_timeout = 60
request_total_timeout = 180
federation_timeout = 300
sender_timeout = 120
client_receive_timeout = 60
client_request_timeout = 120
client_response_timeout = 60

# Registration - SECURE BY DEFAULT
# IMPORTANT: Registration is completely disabled for security
# Bots must be pre-registered manually or through admin API
allow_registration = false
yes_i_am_very_very_sure_i_want_an_open_registration_server_prone_to_abuse = false

# Guest registration also disabled
allow_guest_registration = false

# Features
allow_encryption = true
allow_federation = false  # Override with TUWUNEL_ALLOW_FEDERATION env var
allow_room_creation = true
allow_unstable_room_versions = false  # More secure
allow_legacy_media = false  # More secure

# Presence and typing
allow_local_presence = true
allow_incoming_presence = true
allow_outgoing_presence = true
allow_incoming_typing = true
allow_outgoing_typing = true
typing_federation_timeout_s = 30
typing_client_timeout_max_s = 60

# Performance optimizations
startup_netburst = true
startup_netburst_keep = 500  # Moderate message retention
query_all_nameservers = false
dns_cache_entries = 32768  # Standard DNS cache
dns_min_ttl = 300  # Standard TTL

# Database performance
rocksdb_compression_algo = "lz4"
rocksdb_log_level = "warn"
rocksdb_max_log_files = 3
rocksdb_optimize_for_spinning_disks = false
rocksdb_direct_io = true

# Pool and stream settings
db_pool_workers = 32  # Standard worker count
db_pool_queue_mult = 4  # Standard queue multiplier
stream_width_scale = 1.0  # Standard stream width
stream_amplification = 1024  # Standard batch sizes

# Logging
log = "info"
log_colors = true

# Admin settings
admin_room_notices = true
admin_escape_commands = true

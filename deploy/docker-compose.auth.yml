# Authentication overlay for docker-compose.yml
# This adds basic authentication to the frontend using Traefik middleware
#
# Usage: docker compose -f docker-compose.yml -f docker-compose.auth.yml up -d

services:
  frontend:
    labels:
      # Create auth middleware (basic auth)
      - traefik.http.middlewares.${INSTANCE_NAME:-mindroom}-auth.basicauth.users=${AUTH_USERS}
      - traefik.http.middlewares.${INSTANCE_NAME:-mindroom}-auth.basicauth.realm=${AUTH_REALM:-Mindroom Access}
      - traefik.http.middlewares.${INSTANCE_NAME:-mindroom}-auth.basicauth.removeheader=true

      # Apply auth middleware to frontend router (but not API)
      - traefik.http.routers.${INSTANCE_NAME:-mindroom}.middlewares=${INSTANCE_NAME:-mindroom}-auth

      # Optional: Add rate limiting to prevent brute force attacks
      - traefik.http.middlewares.${INSTANCE_NAME:-mindroom}-ratelimit.ratelimit.average=10
      - traefik.http.middlewares.${INSTANCE_NAME:-mindroom}-ratelimit.ratelimit.burst=20
      - traefik.http.routers.${INSTANCE_NAME:-mindroom}.middlewares=${INSTANCE_NAME:-mindroom}-auth,${INSTANCE_NAME:-mindroom}-ratelimit
